<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36" version="28.1.2">
  <diagram name="第 1 页" id="S6j19A8CV0iWBuxTnP06">
    <mxGraphModel dx="1275" dy="667" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-53" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;strokeColor=#FF0000;" vertex="1" parent="1">
          <mxGeometry x="10" y="410" width="450" height="280" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-52" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;strokeColor=#FF0000;" vertex="1" parent="1">
          <mxGeometry x="10" y="100" width="450" height="280" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-12">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-12" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;OCC模型结果&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="180" y="50" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" target="g3FOl8xGY1Zu4IfsFYsX-22">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="197" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-15" target="g3FOl8xGY1Zu4IfsFYsX-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-15" value="&lt;p&gt;提取地面类别的置信度，优先处理地面类别：置信度&amp;gt;0.5判定为地面&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="120" width="420" height="60" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" target="g3FOl8xGY1Zu4IfsFYsX-30">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="310" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-22" target="g3FOl8xGY1Zu4IfsFYsX-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-22" value="&lt;p&gt;&lt;/p&gt;&lt;p&gt;非地面的区域保持原有逻辑，置信度&amp;lt;0.7判定为free&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="216" width="420" height="60" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-30" target="g3FOl8xGY1Zu4IfsFYsX-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-30" value="&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;处理occ占据细分类seg_pred&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="313" width="420" height="60" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-33" target="g3FOl8xGY1Zu4IfsFYsX-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-33" value="&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;判断每个(x,y)位置在任意z高度是否有地面&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="430" width="420" height="60" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-35" target="g3FOl8xGY1Zu4IfsFYsX-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-35" value="&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;判断每个(x,y)位置在任意z高度是否有others（占据）&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="520" width="420" height="60" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-37" target="g3FOl8xGY1Zu4IfsFYsX-41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-37" value="&lt;meta charset=&quot;utf-8&quot;&gt;&lt;p&gt;构建结果：有地面则为地面类别，否则判断是否有others，有则为占据类别，否则为free类别&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="610" width="420" height="60" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="g3FOl8xGY1Zu4IfsFYsX-41" target="g3FOl8xGY1Zu4IfsFYsX-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-41" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;结束&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="180" y="700" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-43" value="&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;occ_scores = F.softmax(outs[&#39;occ_pred&#39;], dim=-1)   # outs[&#39;occ_pred&#39;].shape: (275, 120, 9, 4)&lt;/li&gt;&lt;li&gt;ground_confidences = occ_scores[..., 2]   # 地面类别是索引2; ground_confidences.shape: (275, 120, 9)&lt;/li&gt;&lt;li&gt;occ_confidences, occ_pred_cls = torch.max(occ_scores, dim=-1)&lt;/li&gt;&lt;li&gt;sem_pred = torch.full_like(occ_pred_cls, class_free)  # class_free = 11；sem_pred.shape: (275, 120, 9) ，初始化预测结果为11&lt;/li&gt;&lt;li&gt;ground_mask = (ground_confidences &amp;gt; 0.5)&lt;/li&gt;&lt;li&gt;sem_pred[ground_mask] = class_ground     # class_ground = 10&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="438" y="80" width="730" height="120" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-44" value="&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;non_ground_mask = ~ground_mask&lt;/li&gt;&lt;li&gt;low_conf_mask = (occ_confidences &amp;lt; 0.7) &amp;amp; non_ground_mask&lt;/li&gt;&lt;li&gt;occ_pred_cls[low_conf_mask] = 3   # free类别索引是3&lt;/li&gt;&lt;li&gt;sem_pred[non_ground_mask &amp;amp; (occ_pred_cls==3)] = class_free        # class_free = 11&lt;/li&gt;&lt;li&gt;sem_pred[non_ground_mask &amp;amp; (occ_pred_cls==0)] = class_others_occ  # class_others_occ = 8&lt;/li&gt;&lt;li&gt;sem_pred[non_ground_mask &amp;amp; (occ_pred_cls==1)] = class_obj         # class_obj = 9&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="438" y="184" width="570" height="120" as="geometry" />
        </mxCell>
        <UserObject label="&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;sem_scores = F.softmax(outs[&#39;seg_pred&#39;], dim=-1)  # outs[&#39;seg_pred&#39;].shape: (275, 120, 9, 9)&lt;/li&gt;&lt;li&gt;cls_score, cls_id = torch.max(sem_scores, dim=-1)&lt;/li&gt;&lt;li&gt;cls_id[cls_score &amp;lt; 0.3] = class_free&lt;/li&gt;&lt;li&gt;gop_mask = (cls_id &amp;lt; class_others_occ) &amp;amp; (occ_pred_cls==class_others_occ) &amp;amp; non_ground_mask # 只在非地面区域应用seg_pred结果&lt;/li&gt;&lt;li&gt;sem_pred[gop_mask] = cls_id[gop_mask]&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" link="&lt;p&gt;sem_scores = F.softmax(outs[&#39;seg_pred&#39;], dim=-1)  # outs[&#39;seg_pred&#39;].shape: (275, 120, 9, 9)&lt;/p&gt;&#xa;&lt;p&gt;cls_score, cls_id = torch.max(sem_scores, dim=-1)&lt;/p&gt;&#xa;&lt;p&gt;cls_id[cls_score &amp;lt; 0.3] = class_free&lt;/p&gt;&#xa;&lt;p&gt;gop_mask = (cls_id &amp;lt; class_others_occ) &amp;amp; (occ_pred_cls==class_others_occ) &amp;amp; non_ground_mask # 只在非地面区域应用seg_pred结果&lt;/p&gt;&#xa;&lt;p&gt;sem_pred[gop_mask] = cls_id[gop_mask]&lt;/p&gt;" id="g3FOl8xGY1Zu4IfsFYsX-45">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="438" y="287" width="790" height="120" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-49" value="&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;has_ground = np.any(sem_pred == class_ground, axis=-1)  # has_ground.shape: (275, 120)&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="428" y="435" width="550" height="50" as="geometry" />
        </mxCell>
        <UserObject label="&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;has_others = np.any(sem_pred == class_others_occ, axis=-1)  # has_others.shape: (275, 120)&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" link="&lt;p&gt;has_others = np.any(sem_pred == class_others_occ, axis=-1)  # has_others.shape: (275, 120)&lt;/p&gt;" id="g3FOl8xGY1Zu4IfsFYsX-50">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="438" y="525" width="550" height="60" as="geometry" />
          </mxCell>
        </UserObject>
        <UserObject label="&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;bev_occ_res = np.where(has_ground, class_ground, np.where(has_others, class_others_occ, class_free))&lt;/li&gt;&lt;li&gt;return bev_occ_res&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" link="&lt;p&gt;bev_occ_res = np.where(has_ground,&lt;/p&gt;&#xa;&lt;p&gt;                    class_ground,&lt;/p&gt;&#xa;&lt;p&gt;                    np.where(has_others,&lt;/p&gt;&#xa;&lt;p&gt;                            class_others_occ,&lt;/p&gt;&#xa;&lt;p&gt;                            class_free))&lt;/p&gt;&#xa;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&#xa;&lt;p&gt;return bev_occ_res&lt;/p&gt;" id="g3FOl8xGY1Zu4IfsFYsX-51">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="438" y="605" width="630" height="70" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-55" value="&lt;font style=&quot;color: rgb(255, 0, 0);&quot;&gt;1、解码&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="240" y="97" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="g3FOl8xGY1Zu4IfsFYsX-56" value="&lt;font style=&quot;color: rgb(255, 0, 0);&quot;&gt;2、后处理&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="235" y="405" width="80" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
